<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini Browser</title>

  <!-- Ultraviolet setup -->
  <script src="/uv/uv.bundle.js"></script>
  <script src="/uv/uv.config.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/uv/sw.js", {
          scope: __uv$config.prefix,
        });
      });
    }
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      background: #1a1a1a;
      color: #fff;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* ---------- Tabs Bar ---------- */
    .tabbar {
      display: flex;
      align-items: center;
      background: #202124;
      height: 45px;
      padding: 0 8px;
      border-bottom: 1px solid #333;
      overflow-x: auto;
    }

    .tab {
      display: flex;
      align-items: center;
      background: #2b2b30;
      padding: 5px 12px;
      margin-right: 6px;
      border-radius: 8px 8px 0 0;
      color: #ccc;
      font-size: 0.9em;
      cursor: pointer;
      transition: background 0.2s;
      user-select: none;
      white-space: nowrap;
    }

    .tab.active {
      background: #3a3a42;
      color: #fff;
    }

    .tab span {
      margin-right: 8px;
    }

    .close-btn {
      background: none;
      border: none;
      color: #bbb;
      font-size: 14px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close-btn:hover {
      color: #ff4444;
    }

    .new-tab-btn {
      background: none;
      border: none;
      color: #0abaff;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      margin-left: auto;
      padding: 0 8px;
      transition: color 0.2s;
    }

    .new-tab-btn:hover {
      color: #4dcfff;
    }

    /* ---------- Address bar ---------- */
    .address-bar {
      display: flex;
      align-items: center;
      background: #2a2b31;
      height: 50px;
      padding: 0 10px;
      border-bottom: 1px solid #333;
    }

    .address-bar:focus-within {
      box-shadow: 0 0 8px #0078ff;
    }

    #urlInput {
      flex: 1;
      height: 35px;
      background: #1f1f23;
      border: none;
      outline: none;
      color: #eaeaea;
      font-size: 16px;
      padding-left: 10px;
      border-radius: 20px;
    }

    #searchButton {
      background: linear-gradient(135deg, #00b4ff, #0078ff);
      border: none;
      outline: none;
      color: #fff;
      font-weight: bold;
      border-radius: 20px;
      padding: 8px 16px;
      margin-left: 8px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    #searchButton:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px #0078ff;
    }

    /* ---------- Iframe area ---------- */
    .iframeWindow {
      flex-grow: 1;
      width: 100%;
      border: none;
      background-color: #111;
    }

    ::-webkit-scrollbar {
      height: 6px;
    }
    ::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #777;
    }
  </style>
</head>

<body>
  <!-- Tabs bar -->
  <div class="tabbar" id="tabbar">
    <div class="tab active" data-id="0">
      <span>New Tab</span>
      <button class="close-btn" onclick="closeTab(event, 0)">×</button>
    </div>
    <button class="new-tab-btn" onclick="addTab()">+</button>
  </div>

  <!-- Address bar -->
  <div class="address-bar">
    <input type="text" id="urlInput" placeholder="Search or enter a URL">
    <button id="searchButton" onclick="navigate()">Go</button>
  </div>

  <!-- Main iframe display -->
  <iframe id="iframeWindow" class="iframeWindow"></iframe>

  <script>
    const tabs = [];
    let currentTab = 0;
    const iframe = document.getElementById("iframeWindow");
    const urlInput = document.getElementById("urlInput");

    // Create initial tab
    tabs.push({ id: 0, title: "New Tab", url: "" });

    function addTab() {
      const id = Date.now();
      tabs.push({ id, title: "New Tab", url: "" });
      renderTabs();
      switchTab(id);
    }

    function closeTab(event, id) {
      event.stopPropagation();
      const index = tabs.findIndex(t => t.id === id);
      if (index > -1) tabs.splice(index, 1);

      if (tabs.length === 0) {
        addTab();
      } else if (currentTab === id) {
        const next = tabs[Math.max(index - 1, 0)];
        switchTab(next.id);
      }

      renderTabs();
    }

    function switchTab(id) {
      currentTab = id;
      document.querySelectorAll(".tab").forEach(tab => {
        tab.classList.toggle("active", parseInt(tab.dataset.id) === id);
      });

      const tabData = tabs.find(t => t.id === id);
      if (tabData.url) iframe.src = tabData.url;
      else iframe.removeAttribute("src");

      urlInput.value = tabData.url || "";
    }

    function renderTabs() {
      const bar = document.getElementById("tabbar");
      bar.innerHTML = "";

      tabs.forEach(t => {
        const tabDiv = document.createElement("div");
        tabDiv.className = "tab" + (t.id === currentTab ? " active" : "");
        tabDiv.dataset.id = t.id;
        tabDiv.innerHTML = `<span>${t.title}</span><button class='close-btn' onclick='closeTab(event, ${t.id})'>×</button>`;
        tabDiv.onclick = () => switchTab(t.id);
        bar.appendChild(tabDiv);
      });

      const addBtn = document.createElement("button");
      addBtn.className = "new-tab-btn";
      addBtn.innerText = "+";
      addBtn.onclick = addTab;
      bar.appendChild(addBtn);
    }

    function navigate() {
      const input = urlInput.value.trim();
      const url = input.startsWith("http") ? input : "https://" + input;
      iframe.src = url;
      const tab = tabs.find(t => t.id === currentTab);
      if (tab) {
        tab.url = url;
        tab.title = url.replace(/^https?:\/\//, "").split("/")[0];
      }
      renderTabs();
    }

    iframe.addEventListener("load", () => {
      try {
        const tab = tabs.find(t => t.id === currentTab);
        const title = iframe.contentDocument.title || "New Tab";
        if (tab) tab.title = title;
        renderTabs();
      } catch {
        // cross-origin pages block title access
        const tab = tabs.find(t => t.id === currentTab);
        if (tab) tab.title = new URL(tab.url).hostname;
        renderTabs();
      }
    });

    renderTabs();
  </script>
</body>
</html>
