<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>T9 Mini Browser</title>

  <!-- Ultraviolet setup -->
  <script src="/uv/uv.bundle.js"></script>
  <script src="/uv/uv.config.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/uv/sw.js", {
          scope: __uv$config.prefix,
        });
      });
    }
  </script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif; }
    body { background:#111; color:white; height:100vh; overflow:hidden; display:flex; flex-direction:column; }

    /* Tabs bar */
    .tabbar {
      display:flex;
      align-items:center;
      background:#202124;
      height:40px;
      padding:0 8px;
      border-bottom:1px solid #333;
      overflow-x:auto;
    }
    .tab {
      display:flex;
      align-items:center;
      background:#2b2b30;
      padding:4px 12px;
      margin-right:6px;
      border-radius:8px 8px 0 0;
      color:#ccc;
      font-size:0.9em;
      cursor:pointer;
      white-space:nowrap;
    }
    .tab.active { background:#3a3a42; color:#fff; }
    .tab span { margin-right:6px; }
    .close-btn { background:none; border:none; color:#bbb; font-size:14px; cursor:pointer; }
    .close-btn:hover { color:#ff4444; }
    .new-tab-btn { background:none; border:none; color:#0abaff; font-size:20px; font-weight:bold; cursor:pointer; margin-left:auto; padding:0 8px; }
    .new-tab-btn:hover { color:#4dcfff; }

    /* Home / search screen */
    .homeScreen { display:flex; flex-direction:column; align-items:center; justify-content:center; flex-grow:1; }
    .search-container { text-align:center; width:80%; max-width:700px; }
    .title { font-size:2.5em; margin-bottom:20px; color:#00b4ff; }
    .search-bar { display:flex; width:100%; height:50px; background:#222; border-radius:50px; overflow:hidden; }
    #urlInput { flex:1; padding-left:20px; border:none; outline:none; font-size:1.1em; background:transparent; color:#eee; }
    #searchButton { padding:0 25px; border:none; outline:none; cursor:pointer; background:linear-gradient(135deg,#00b4ff,#0078ff); color:#fff; font-weight:bold; transition:0.2s ease; }
    #searchButton:hover { transform:scale(1.05); }

    /* Iframe area */
    .iframeWindow { width:100%; flex-grow:1; border:none; display:none; }

    /* Back to home button */
    .backButton { position:absolute; top:50px; left:10px; background:#0078ff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; color:#fff; font-weight:bold; display:none; z-index:1000; }
  </style>
</head>

<body>
  <!-- Tabs -->
  <div class="tabbar" id="tabbar">
    <button class="new-tab-btn" onclick="addTab()">+</button>
  </div>

  <!-- Back button -->
  <button class="backButton" id="backButton">← Home</button>

  <!-- Home screen -->
  <div class="homeScreen" id="homeScreen">
    <div class="search-container">
      <div class="title">T9 Mini Browser</div>
      <div class="search-bar">
        <input type="text" id="urlInput" placeholder="Enter URL or search..."/>
        <button id="searchButton">Go</button>
      </div>
    </div>
  </div>

  <!-- Iframe for pages -->
  <iframe id="iframeWindow" class="iframeWindow"></iframe>

  <script>
    const duckDuckGo = "https://duckduckgo.com/?q=";

    const tabbar = document.getElementById("tabbar");
    const home = document.getElementById("homeScreen");
    const iframe = document.getElementById("iframeWindow");
    const backBtn = document.getElementById("backButton");
    const input = document.getElementById("urlInput");
    const searchBtn = document.getElementById("searchButton");

    let tabs = [];
    let currentTabId = null;

    function renderTabs() {
      tabbar.innerHTML = "";
      tabs.forEach(tab => {
        const div = document.createElement("div");
        div.className = "tab" + (tab.id === currentTabId ? " active" : "");
        div.dataset.id = tab.id;
        div.innerHTML = `<span>${tab.title}</span><button class="close-btn" onclick="closeTab(event, ${tab.id})">×</button>`;
        div.onclick = () => switchTab(tab.id);
        tabbar.appendChild(div);
      });
      const addBtn = document.createElement("button");
      addBtn.className = "new-tab-btn";
      addBtn.innerText = "+";
      addBtn.onclick = addTab;
      tabbar.appendChild(addBtn);
    }

    function addTab() {
      const id = Date.now();
      tabs.push({ id, title: "New Tab", url: "" });
      switchTab(id);
      renderTabs();
    }

    function closeTab(event, id) {
      event.stopPropagation();
      const index = tabs.findIndex(t => t.id === id);
      if(index > -1) tabs.splice(index,1);
      if(tabs.length === 0) addTab();
      else if(currentTabId === id) switchTab(tabs[Math.max(index-1,0)].id);
      renderTabs();
    }

    function switchTab(id) {
      currentTabId = id;
      renderTabs();
      const tab = tabs.find(t => t.id === id);
      if(tab.url) {
        iframe.src = tab.url;
        iframe.style.display = "block";
        home.style.display = "none";
        backBtn.style.display = "block";
      } else {
        iframe.src = "";
        iframe.style.display = "none";
        home.style.display = "flex";
        backBtn.style.display = "none";
      }
    }

    function navigate(urlInputValue) {
      let query = urlInputValue.trim();
      if(!query) return;

      const isProbablyURL = query.includes(".") && !query.includes(" ");
      let url = isProbablyURL ? (/^https?:\/\//i.test(query) ? query : "https://"+query) : duckDuckGo + encodeURIComponent(query);

      const tab = tabs.find(t => t.id === currentTabId);
      if(tab) {
        tab.url = __uv$config.prefix + __uv$config.encodeUrl(url);
        tab.title = isProbablyURL ? query.replace(/^https?:\/\//,"") : query;
      }

      iframe.src = tabs.find(t=>t.id===currentTabId).url;
      iframe.style.display = "block";
      home.style.display = "none";
      backBtn.style.display = "block";
      renderTabs();
    }

    // Event listeners
    searchBtn.addEventListener("click", () => navigate(input.value));
    input.addEventListener("keydown", (e) => { if(e.key==="Enter") navigate(input.value); });
    backBtn.addEventListener("click", () => {
      iframe.src = "";
      iframe.style.display = "none";
      home.style.display = "flex";
      backBtn.style.display = "none";
      const tab = tabs.find(t=>t.id===currentTabId);
      if(tab) tab.url="";
      input.value="";
      renderTabs();
    });

    // Initialize first tab
    addTab();
  </script>
</body>
</html>
