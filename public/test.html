<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>T9 OS Browser</title>

<!-- BareMux script -->
<script type="module">
  import BareMux from './uv/index.js';

  window.baremux = new BareMux.BareClient();
</script>

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:system-ui,sans-serif; }
body { height:100vh; display:flex; flex-direction:column; background:#111; color:white; overflow:hidden; }
.address-bar { display:flex; align-items:center; background:#222; height:50px; padding:0 10px; border-bottom:1px solid #333; }
.nav-button { background:#333; border:none; color:#fff; padding:6px 12px; margin-right:6px; border-radius:6px; cursor:pointer; font-weight:bold; }
.nav-button:hover { background:#0078ff; }
#urlInput { flex:1; height:34px; padding:0 10px; border-radius:10px; border:1px solid #555; outline:none; font-size:1em; background:#1c1c1c; color:#e8e8e8; }
#searchButton { background:#0078ff; border:none; color:white; padding:0 15px; margin-left:6px; border-radius:10px; cursor:pointer; font-weight:bold; }
#searchButton:hover { background:#005dc1; }
.content { flex-grow:1; padding:10px; overflow:auto; background:#111; }
</style>
</head>
<body>

<div class="address-bar">
  <button class="nav-button" id="backBtn">←</button>
  <button class="nav-button" id="forwardBtn">→</button>
  <button class="nav-button" id="refreshBtn">⟳</button>
  <input type="text" id="urlInput" placeholder="Enter URL or search...">
  <button id="searchButton">Go</button>
</div>

<div class="content" id="content"></div>

<script type="module">
const duckDuckGo = "https://duckduckgo.com/?q=";
const input = document.getElementById("urlInput");
const searchBtn = document.getElementById("searchButton");
const content = document.getElementById("content");

let historyStack = [];
let historyIndex = -1;

async function navigate(query) {
  if (!query) return;
  const isURL = query.includes(".") && !query.includes(" ");
  const fullURL = isURL ? (/^https?:\/\//i.test(query) ? query : "https://" + query)
                        : duckDuckGo + encodeURIComponent(query);
  await loadURL(fullURL);
}

async function loadURL(url) {
  try {
    const response = await window.baremux.fetch(url);
    const html = await response.text();
    content.innerHTML = html;

    // update history
    historyStack = historyStack.slice(0, historyIndex + 1);
    historyStack.push(url);
    historyIndex = historyStack.length - 1;

    input.value = url;
  } catch (err) {
    content.innerHTML = `<p style="color:red;">Failed to load: ${url}</p>`;
    console.error(err);
  }
}

searchBtn.onclick = () => navigate(input.value);
input.addEventListener("keydown", e => e.key === "Enter" && navigate(input.value));

document.getElementById("backBtn").onclick = () => {
  if (historyIndex > 0) {
    historyIndex--;
    loadURL(historyStack[historyIndex]);
  }
};
document.getElementById("forwardBtn").onclick = () => {
  if (historyIndex < historyStack.length - 1) {
    historyIndex++;
    loadURL(historyStack[historyIndex]);
  }
};
document.getElementById("refreshBtn").onclick = () => {
  if (historyIndex >= 0) loadURL(historyStack[historyIndex]);
};
</script>

</body>
</html>
