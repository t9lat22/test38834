<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T9 OS Browser</title>

<script src="/uv/uv.bundle.js" defer></script>
<script src="/uv/uv.config.js" defer></script>

<style>
  body { margin:0; font-family:system-ui; background:#111; color:white; display:flex; flex-direction:column; height:100vh; }
  .address-bar { display:flex; padding:6px; background:#222; }
  .address-bar input { flex:1; padding:6px 10px; border-radius:8px; border:none; background:#333; color:white; }
  .address-bar button { margin-left:6px; padding:6px 12px; border:none; border-radius:8px; background:#0078ff; color:white; cursor:pointer; }
  .content { flex:1; overflow:auto; padding:10px; }
</style>
</head>

<body>
<div class="address-bar">
  <input type="text" id="urlInput" placeholder="Enter URL">
  <button id="goBtn">Go</button>
</div>
<div class="content" id="content">
  <p>Enter a URL above and press Go</p>
</div>

<script>
  const PROXY = __uv$config?.prefix || "/uv/";
  const content = document.getElementById("content");
  const input = document.getElementById("urlInput");
  const goBtn = document.getElementById("goBtn");

  async function loadURL(url) {
    if(!url) return;
    if(!/^https?:\/\//i.test(url)) url = "https://" + url;

    try {
      const proxied = PROXY + __uv$config.encodeUrl(url);
      const res = await fetch(proxied);
      const text = await res.text();
      content.innerHTML = text;
    } catch(err) {
      content.innerHTML = `<p style="color:red">Cannot GET proxy: ${err}</p>`;
    }
  }

  goBtn.onclick = () => loadURL(input.value);
  input.addEventListener("keydown", e => { if(e.key==="Enter") loadURL(input.value); });

  // register service worker
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register("/uv/sw.js",{scope:PROXY})
      .then(()=>console.log("Service worker registered"))
      .catch(console.error);
  }
</script>
</body>
</html>
